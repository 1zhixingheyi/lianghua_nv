# é‡åŒ–äº¤æ˜“ç³»ç»Ÿå¼€å‘è€…æŒ‡å—

## ğŸ“‹ å¼€å‘æ¦‚è¿°

æœ¬æŒ‡å—é¢å‘é‡åŒ–äº¤æ˜“ç³»ç»Ÿçš„å¼€å‘è€…ï¼Œæä¾›è¯¦ç»†çš„å¼€å‘ç¯å¢ƒæ­å»ºã€ä»£ç è§„èŒƒã€æ¶æ„è¯´æ˜ã€APIå¼€å‘ã€æµ‹è¯•æ–¹æ³•ç­‰å†…å®¹ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹é¡¹ç›®å¼€å‘ã€‚

## ğŸ¯ å¼€å‘ç¯å¢ƒ

### å¿…å¤‡è½¯ä»¶

#### Pythonç¯å¢ƒ
- **Pythonç‰ˆæœ¬**: 3.8+ (æ¨è3.9)
- **åŒ…ç®¡ç†å™¨**: pip (æœ€æ–°ç‰ˆæœ¬)
- **è™šæ‹Ÿç¯å¢ƒ**: venv æˆ– conda

#### å¼€å‘å·¥å…·
- **IDE**: PyCharm Professional / VS Code
- **ç‰ˆæœ¬æ§åˆ¶**: Git 2.20+
- **æ•°æ®åº“å·¥å…·**: MySQL Workbench / DataGrip
- **APIæµ‹è¯•**: Postman / Insomnia
- **å®¹å™¨**: Docker Desktop

#### ç³»ç»Ÿä¾èµ–
```bash
# Ubuntu/Debian
sudo apt install -y build-essential python3-dev libmysqlclient-dev

# CentOS/RHEL
sudo yum install -y gcc python3-devel mysql-devel

# macOS
brew install mysql-client pkg-config
```

### ç¯å¢ƒæ­å»º

#### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/your-repo/lianghua_vn.git
cd lianghua_vn
```

#### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
# ä½¿ç”¨venv
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

# æˆ–ä½¿ç”¨conda
conda create -n lianghua python=3.9
conda activate lianghua
```

#### 3. å®‰è£…ä¾èµ–
```bash
# å‡çº§pip
pip install --upgrade pip

# å®‰è£…å¼€å‘ä¾èµ–
pip install -r requirements.txt
pip install -r requirements-dev.txt

# å®‰è£…é¢„æäº¤é’©å­
pre-commit install
```

#### 4. é…ç½®å¼€å‘ç¯å¢ƒ
```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp .env.example .env.dev
cp config.json.example config.dev.json

# ç¼–è¾‘é…ç½®
vim .env.dev
```

```bash
# .env.dev å¼€å‘ç¯å¢ƒé…ç½®
DEBUG=True
FLASK_ENV=development
DATABASE_URL=mysql://dev_user:dev_pass@localhost/lianghua_dev
REDIS_URL=redis://localhost:6379/1
TUSHARE_TOKEN=your_dev_token
SECRET_KEY=dev_secret_key
LOG_LEVEL=DEBUG
```

#### 5. åˆå§‹åŒ–æ•°æ®åº“
```bash
# åˆ›å»ºå¼€å‘æ•°æ®åº“
mysql -u root -p -e "CREATE DATABASE lianghua_dev"

# è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–
python scripts/init_dev_db.py

# å¯¼å…¥æµ‹è¯•æ•°æ®
python scripts/import_test_data.py
```

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### ç›®å½•ç»“æ„è¯¦è§£

```
lianghua_vn/
â”œâ”€â”€ backtest/                    # å›æµ‹å¼•æ“
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ engine.py               # å›æµ‹æ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ event_driven.py         # äº‹ä»¶é©±åŠ¨æ¡†æ¶
â”‚   â”œâ”€â”€ portfolio.py            # æŠ•èµ„ç»„åˆç®¡ç†
â”‚   â””â”€â”€ performance.py          # æ€§èƒ½åˆ†æ
â”œâ”€â”€ data/                       # æ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database.py            # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ stock_data.py          # è‚¡ç¥¨æ•°æ®è·å–
â”‚   â””â”€â”€ data_manager.py        # æ•°æ®ç®¡ç†å™¨
â”œâ”€â”€ monitor/                    # Webç›‘æ§é¢æ¿
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ web_app.py             # Flaskåº”ç”¨ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ api_routes.py          # APIè·¯ç”±
â”‚   â”œâ”€â”€ static/                # é™æ€æ–‡ä»¶
â”‚   â””â”€â”€ templates/             # HTMLæ¨¡æ¿
â”œâ”€â”€ risk/                       # é£æ§ç³»ç»Ÿ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ risk_engine.py         # é£æ§å¼•æ“
â”‚   â”œâ”€â”€ position_manager.py    # ä»“ä½ç®¡ç†
â”‚   â””â”€â”€ risk_models.py         # é£é™©æ¨¡å‹
â”œâ”€â”€ strategies/                 # ç­–ç•¥æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_strategy.py       # ç­–ç•¥åŸºç±»
â”‚   â”œâ”€â”€ rsi_strategy.py        # RSIç­–ç•¥å®ç°
â”‚   â””â”€â”€ strategy_manager.py    # ç­–ç•¥ç®¡ç†å™¨
â”œâ”€â”€ trading/                    # äº¤æ˜“æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_trader.py         # äº¤æ˜“æ¥å£åŸºç±»
â”‚   â”œâ”€â”€ qmt_trader.py          # QMTäº¤æ˜“æ¥å£
â”‚   â””â”€â”€ order_manager.py       # è®¢å•ç®¡ç†
â”œâ”€â”€ tests/                      # æµ‹è¯•ä»£ç 
â”œâ”€â”€ scripts/                    # è„šæœ¬å·¥å…·
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”œâ”€â”€ config.json                 # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt            # ç”Ÿäº§ä¾èµ–
â”œâ”€â”€ requirements-dev.txt        # å¼€å‘ä¾èµ–
â””â”€â”€ run_monitor.py             # å¯åŠ¨è„šæœ¬
```

### æ ¸å¿ƒæ¨¡å—è¯´æ˜

#### 1. å›æµ‹å¼•æ“ (backtest/)
è´Ÿè´£ç­–ç•¥çš„å†å²æ•°æ®å›æµ‹ï¼Œè¯„ä¼°ç­–ç•¥æ€§èƒ½ã€‚

```python
# backtest/engine.py æ ¸å¿ƒç±»
class BacktestEngine:
    """å›æµ‹å¼•æ“æ ¸å¿ƒç±»"""
    
    def __init__(self, strategy, start_date, end_date, initial_capital):
        self.strategy = strategy
        self.start_date = start_date
        self.end_date = end_date
        self.initial_capital = initial_capital
        
    def run(self):
        """æ‰§è¡Œå›æµ‹"""
        pass
```

#### 2. æ•°æ®ç®¡ç† (data/)
ç»Ÿä¸€ç®¡ç†è‚¡ç¥¨æ•°æ®çš„è·å–ã€å­˜å‚¨å’ŒæŸ¥è¯¢ã€‚

```python
# data/data_manager.py æ ¸å¿ƒç±»
class DataManager:
    """æ•°æ®ç®¡ç†å™¨"""
    
    def get_stock_data(self, symbol, start_date, end_date):
        """è·å–è‚¡ç¥¨æ•°æ®"""
        pass
        
    def update_daily_data(self):
        """æ›´æ–°æ—¥çº¿æ•°æ®"""
        pass
```

#### 3. ç­–ç•¥æ¨¡å— (strategies/)
æä¾›ç­–ç•¥å¼€å‘æ¡†æ¶å’Œå…·ä½“ç­–ç•¥å®ç°ã€‚

```python
# strategies/base_strategy.py åŸºç±»
class BaseStrategy:
    """ç­–ç•¥åŸºç±»"""
    
    def __init__(self, name):
        self.name = name
        
    def on_data(self, context, data):
        """æ•°æ®æ›´æ–°å›è°ƒ"""
        pass
        
    def on_order_status(self, context, order):
        """è®¢å•çŠ¶æ€å›è°ƒ"""
        pass
```

#### 4. é£æ§ç³»ç»Ÿ (risk/)
å®ç°å¤šå±‚æ¬¡é£é™©æ§åˆ¶æœºåˆ¶ã€‚

```python
# risk/risk_engine.py æ ¸å¿ƒç±»
class RiskEngine:
    """é£æ§å¼•æ“"""
    
    def check_order(self, order):
        """è®¢å•é£æ§æ£€æŸ¥"""
        pass
        
    def check_position(self, position):
        """æŒä»“é£æ§æ£€æŸ¥"""
        pass
```

#### 5. äº¤æ˜“æ¨¡å— (trading/)
å¯¹æ¥ä¸åŒåˆ¸å•†æ¥å£ï¼Œç»Ÿä¸€äº¤æ˜“æ“ä½œã€‚

```python
# trading/base_trader.py åŸºç±»
class BaseTrader:
    """äº¤æ˜“æ¥å£åŸºç±»"""
    
    def place_order(self, symbol, quantity, price, order_type):
        """ä¸‹å•"""
        pass
        
    def cancel_order(self, order_id):
        """æ’¤å•"""
        pass
```

## ğŸ“ ç¼–ç è§„èŒƒ

### Pythonä»£ç è§„èŒƒ

#### 1. ä»£ç é£æ ¼
éµå¾ª PEP 8 è§„èŒƒï¼Œä½¿ç”¨ä»¥ä¸‹å·¥å…·ç¡®ä¿ä»£ç è´¨é‡ï¼š

```bash
# ä»£ç æ ¼å¼åŒ–
black .
isort .

# ä»£ç æ£€æŸ¥
flake8 .
pylint src/

# ç±»å‹æ£€æŸ¥
mypy .
```

#### 2. å‘½åè§„èŒƒ
```python
# ç±»åï¼šå¤§é©¼å³°å‘½å
class DataManager:
    pass

# å‡½æ•°å’Œå˜é‡ï¼šå°å†™ä¸‹åˆ’çº¿
def get_stock_data():
    stock_price = 100.0
    
# å¸¸é‡ï¼šå¤§å†™ä¸‹åˆ’çº¿
MAX_POSITION_SIZE = 0.1
API_BASE_URL = "https://api.example.com"

# ç§æœ‰æ–¹æ³•ï¼šå‰ç¼€ä¸‹åˆ’çº¿
def _calculate_risk():
    pass
```

#### 3. æ–‡æ¡£å­—ç¬¦ä¸²
```python
def get_stock_data(symbol: str, start_date: str, end_date: str) -> pd.DataFrame:
    """
    è·å–è‚¡ç¥¨å†å²æ•°æ®
    
    Args:
        symbol (str): è‚¡ç¥¨ä»£ç ï¼Œå¦‚ '000001.SZ'
        start_date (str): å¼€å§‹æ—¥æœŸï¼Œæ ¼å¼ 'YYYY-MM-DD'
        end_date (str): ç»“æŸæ—¥æœŸï¼Œæ ¼å¼ 'YYYY-MM-DD'
        
    Returns:
        pd.DataFrame: åŒ…å«OHLCVæ•°æ®çš„DataFrame
        
    Raises:
        ValueError: æ—¥æœŸæ ¼å¼é”™è¯¯
        ConnectionError: æ•°æ®æºè¿æ¥å¤±è´¥
        
    Example:
        >>> data = get_stock_data('000001.SZ', '2023-01-01', '2023-12-31')
        >>> print(data.head())
    """
    pass
```

#### 4. ç±»å‹æ³¨è§£
```python
from typing import Dict, List, Optional, Union
import pandas as pd

class Portfolio:
    def __init__(self, initial_capital: float) -> None:
        self.cash: float = initial_capital
        self.positions: Dict[str, int] = {}
        
    def get_total_value(self, prices: Dict[str, float]) -> float:
        """è®¡ç®—æ€»èµ„äº§ä»·å€¼"""
        return self.cash + sum(
            qty * prices.get(symbol, 0) 
            for symbol, qty in self.positions.items()
        )
```

### Gitå·¥ä½œæµç¨‹

#### 1. åˆ†æ”¯ç­–ç•¥
```bash
# ä¸»åˆ†æ”¯
main/master     # ç”Ÿäº§ç¯å¢ƒä»£ç 
develop         # å¼€å‘åˆ†æ”¯
release/*       # å‘å¸ƒåˆ†æ”¯
feature/*       # åŠŸèƒ½åˆ†æ”¯
hotfix/*        # ä¿®å¤åˆ†æ”¯
```

#### 2. æäº¤è§„èŒƒ
```bash
# æäº¤ä¿¡æ¯æ ¼å¼
<type>(<scope>): <subject>

<body>

<footer>

# ç±»å‹è¯´æ˜
feat:     æ–°åŠŸèƒ½
fix:      ä¿®å¤bug
docs:     æ–‡æ¡£æ›´æ–°
style:    ä»£ç æ ¼å¼è°ƒæ•´
refactor: é‡æ„
test:     æµ‹è¯•ç›¸å…³
chore:    æ„å»ºå·¥å…·ç­‰

# ç¤ºä¾‹
feat(strategy): æ·»åŠ MACDç­–ç•¥å®ç°

- å®ç°MACDæŒ‡æ ‡è®¡ç®—
- æ·»åŠ ä¹°å–ä¿¡å·ç”Ÿæˆé€»è¾‘
- å®Œå–„ç­–ç•¥å›æµ‹åŠŸèƒ½

Closes #123
```

#### 3. ä»£ç å®¡æŸ¥
```bash
# åˆ›å»ºPull Requestå‰æ£€æŸ¥
pre-commit run --all-files
python -m pytest tests/
python run_tests.py
```

## ğŸ”§ å¼€å‘å·¥å…·é…ç½®

### VS Codeé…ç½®

#### 1. æ¨èæ‰©å±•
```json
{
    "recommendations": [
        "ms-python.python",
        "ms-python.black-formatter",
        "ms-python.isort",
        "ms-python.flake8",
        "ms-python.mypy-type-checker",
        "ms-vscode.vscode-json",
        "redhat.vscode-yaml",
        "ms-vscode.vscode-docker"
    ]
}
```

#### 2. å·¥ä½œåŒºè®¾ç½®
```json
{
    "python.defaultInterpreterPath": "./venv/bin/python",
    "python.terminal.activateEnvironment": true,
    "python.linting.enabled": true,
    "python.linting.flake8Enabled": true,
    "python.formatting.provider": "black",
    "python.sortImports.args": ["--profile", "black"],
    "editor.formatOnSave": true,
    "editor.codeActionsOnSave": {
        "source.organizeImports": true
    }
}
```

### PyCharmé…ç½®

#### 1. ä»£ç é£æ ¼è®¾ç½®
- File â†’ Settings â†’ Editor â†’ Code Style â†’ Python
- é€‰æ‹© "Black" é¢„è®¾
- è®¾ç½®è¡Œé•¿åº¦ä¸º 88

#### 2. è§£é‡Šå™¨é…ç½®
- File â†’ Settings â†’ Project â†’ Python Interpreter
- é€‰æ‹©é¡¹ç›®è™šæ‹Ÿç¯å¢ƒä¸­çš„Pythonè§£é‡Šå™¨

#### 3. è¿è¡Œé…ç½®
```python
# åˆ›å»ºè¿è¡Œé…ç½®
Name: Run Monitor
Script path: run_monitor.py
Parameters: --debug
Working directory: /path/to/lianghua_vn
Environment variables: FLASK_ENV=development
```

## ğŸ§ª æµ‹è¯•æŒ‡å—

### æµ‹è¯•æ¡†æ¶

#### 1. å•å…ƒæµ‹è¯• (pytest)
```python
# tests/test_data_manager.py
import pytest
from unittest.mock import Mock, patch
from data.data_manager import DataManager

class TestDataManager:
    def setup_method(self):
        """æµ‹è¯•å‰ç½®è®¾ç½®"""
        self.data_manager = DataManager()
        
    def test_get_stock_data_success(self):
        """æµ‹è¯•æˆåŠŸè·å–è‚¡ç¥¨æ•°æ®"""
        # å‡†å¤‡æµ‹è¯•æ•°æ®
        symbol = "000001.SZ"
        start_date = "2023-01-01"
        end_date = "2023-12-31"
        
        # æ‰§è¡Œæµ‹è¯•
        result = self.data_manager.get_stock_data(symbol, start_date, end_date)
        
        # æ–­è¨€
        assert result is not None
        assert len(result) > 0
        assert "close" in result.columns
        
    def test_get_stock_data_invalid_symbol(self):
        """æµ‹è¯•æ— æ•ˆè‚¡ç¥¨ä»£ç """
        with pytest.raises(ValueError):
            self.data_manager.get_stock_data("INVALID", "2023-01-01", "2023-12-31")
            
    @patch('data.data_manager.requests.get')
    def test_get_stock_data_network_error(self, mock_get):
        """æµ‹è¯•ç½‘ç»œé”™è¯¯"""
        mock_get.side_effect = ConnectionError("Network error")
        
        with pytest.raises(ConnectionError):
            self.data_manager.get_stock_data("000001.SZ", "2023-01-01", "2023-12-31")
```

#### 2. é›†æˆæµ‹è¯•
```python
# tests/test_integration.py
import pytest
from monitor.web_app import create_app

class TestAPIIntegration:
    def setup_method(self):
        """è®¾ç½®æµ‹è¯•å®¢æˆ·ç«¯"""
        self.app = create_app(testing=True)
        self.client = self.app.test_client()
        
    def test_dashboard_api(self):
        """æµ‹è¯•ä»ªè¡¨æ¿API"""
        response = self.client.get('/api/dashboard/summary')
        assert response.status_code == 200
        
        data = response.get_json()
        assert 'total_value' in data
        assert 'daily_return' in data
        
    def test_strategy_list_api(self):
        """æµ‹è¯•ç­–ç•¥åˆ—è¡¨API"""
        response = self.client.get('/api/strategies')
        assert response.status_code == 200
        
        data = response.get_json()
        assert isinstance(data, list)
```

#### 3. æ€§èƒ½æµ‹è¯•
```python
# tests/test_performance.py
import time
import pytest
from backtest.engine import BacktestEngine

class TestPerformance:
    def test_backtest_performance(self):
        """æµ‹è¯•å›æµ‹æ€§èƒ½"""
        # å‡†å¤‡å¤§é‡æµ‹è¯•æ•°æ®
        start_time = time.time()
        
        # æ‰§è¡Œå›æµ‹
        engine = BacktestEngine(strategy, "2020-01-01", "2023-12-31", 1000000)
        result = engine.run()
        
        end_time = time.time()
        execution_time = end_time - start_time
        
        # æ€§èƒ½è¦æ±‚ï¼š3å¹´å›æµ‹åœ¨30ç§’å†…å®Œæˆ
        assert execution_time < 30
        assert result is not None
```

### æµ‹è¯•è¿è¡Œ

#### 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
# è¿è¡Œå…¨éƒ¨æµ‹è¯•
pytest

# è¿è¡ŒæŒ‡å®šæ¨¡å—
pytest tests/test_data_manager.py

# è¿è¡ŒæŒ‡å®šæµ‹è¯•
pytest tests/test_data_manager.py::TestDataManager::test_get_stock_data_success

# è¯¦ç»†è¾“å‡º
pytest -v

# è¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=src --cov-report=html
```

#### 2. æµ‹è¯•é…ç½®
```ini
# pytest.ini
[tool:pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = 
    --strict-markers
    --strict-config
    --disable-warnings
    -ra
markers =
    slow: marks tests as slow
    integration: marks tests as integration tests
    unit: marks tests as unit tests
```

#### 3. æŒç»­é›†æˆæµ‹è¯•
```yaml
# .github/workflows/test.yml
name: Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.8, 3.9, 3.10]
        
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install -r requirements-dev.txt
        
    - name: Run tests
      run: |
        pytest --cov=src --cov-report=xml
        
    - name: Upload coverage
      uses: codecov/codecov-action@v3
```

## ğŸš€ APIå¼€å‘æŒ‡å—

### Flaskåº”ç”¨ç»“æ„

#### 1. åº”ç”¨å·¥å‚æ¨¡å¼
```python
# monitor/web_app.py
from flask import Flask
from flask_cors import CORS
from flask_socketio import SocketIO

def create_app(config_name='default'):
    """åº”ç”¨å·¥å‚å‡½æ•°"""
    app = Flask(__name__)
    
    # åŠ è½½é…ç½®
    app.config.from_object(config[config_name])
    
    # åˆå§‹åŒ–æ‰©å±•
    CORS(app)
    socketio.init_app(app)
    
    # æ³¨å†Œè“å›¾
    from .api_routes import api_bp
    app.register_blueprint(api_bp, url_prefix='/api')
    
    return app
```

#### 2. è“å›¾ç»„ç»‡
```python
# monitor/api_routes.py
from flask import Blueprint, jsonify, request
from flask_jwt_extended import jwt_required, get_jwt_identity

api_bp = Blueprint('api', __name__)

@api_bp.route('/dashboard/summary')
@jwt_required()
def get_dashboard_summary():
    """è·å–ä»ªè¡¨æ¿æ‘˜è¦"""
    try:
        # ä¸šåŠ¡é€»è¾‘
        data = {
            'total_value': 1000000,
            'daily_return': 0.02,
            'positions': []
        }
        return jsonify({'success': True, 'data': data})
    except Exception as e:
        return jsonify({'success': False, 'error': str(e)}), 500
```

### APIè®¾è®¡è§„èŒƒ

#### 1. RESTfulè®¾è®¡
```python
# èµ„æºè·¯ç”±è®¾è®¡
GET    /api/strategies          # è·å–ç­–ç•¥åˆ—è¡¨
POST   /api/strategies          # åˆ›å»ºæ–°ç­–ç•¥
GET    /api/strategies/{id}     # è·å–ç­–ç•¥è¯¦æƒ…
PUT    /api/strategies/{id}     # æ›´æ–°ç­–ç•¥
DELETE /api/strategies/{id}     # åˆ é™¤ç­–ç•¥

GET    /api/positions           # è·å–æŒä»“åˆ—è¡¨
POST   /api/orders              # ä¸‹å•
GET    /api/orders/{id}         # è·å–è®¢å•è¯¦æƒ…
DELETE /api/orders/{id}         # æ’¤å•
```

#### 2. å“åº”æ ¼å¼
```python
# æˆåŠŸå“åº”
{
    "success": true,
    "data": {
        "id": 1,
        "name": "RSIç­–ç•¥",
        "status": "running"
    },
    "message": "æ“ä½œæˆåŠŸ"
}

# é”™è¯¯å“åº”
{
    "success": false,
    "error": {
        "code": "INVALID_PARAMETER",
        "message": "å‚æ•°éªŒè¯å¤±è´¥",
        "details": {
            "symbol": ["è‚¡ç¥¨ä»£ç ä¸èƒ½ä¸ºç©º"]
        }
    }
}

# åˆ†é¡µå“åº”
{
    "success": true,
    "data": [...],
    "pagination": {
        "page": 1,
        "size": 20,
        "total": 100,
        "pages": 5
    }
}
```

#### 3. è¯·æ±‚éªŒè¯
```python
from marshmallow import Schema, fields, validate

class StrategySchema(Schema):
    name = fields.Str(required=True, validate=validate.Length(min=1, max=100))
    symbol = fields.Str(required=True, validate=validate.Regexp(r'^\d{6}\.(SZ|SH)$'))
    params = fields.Dict(required=True)

@api_bp.route('/strategies', methods=['POST'])
@jwt_required()
def create_strategy():
    schema = StrategySchema()
    try:
        data = schema.load(request.json)
    except ValidationError as err:
        return jsonify({'success': False, 'error': err.messages}), 400
        
    # åˆ›å»ºç­–ç•¥é€»è¾‘
    strategy = create_new_strategy(data)
    return jsonify({'success': True, 'data': strategy}), 201
```

### WebSocketå®æ—¶é€šä¿¡

#### 1. SocketIOé›†æˆ
```python
# monitor/websocket_handler.py
from flask_socketio import SocketIO, emit, join_room, leave_room

socketio = SocketIO()

@socketio.on('connect')
def on_connect():
    """å®¢æˆ·ç«¯è¿æ¥"""
    print(f'Client connected: {request.sid}')
    emit('connected', {'data': 'Connected to server'})

@socketio.on('join_room')
def on_join_room(data):
    """åŠ å…¥æˆ¿é—´"""
    room = data['room']
    join_room(room)
    emit('joined_room', {'room': room})

@socketio.on('subscribe_market_data')
def on_subscribe_market_data(data):
    """è®¢é˜…å¸‚åœºæ•°æ®"""
    symbols = data.get('symbols', [])
    for symbol in symbols:
        join_room(f'market_{symbol}')
    emit('subscribed', {'symbols': symbols})
```

#### 2. å®æ—¶æ•°æ®æ¨é€
```python
# åœ¨å…¶ä»–æ¨¡å—ä¸­æ¨é€æ•°æ®
from monitor.web_app import socketio

def push_market_data(symbol, data):
    """æ¨é€å¸‚åœºæ•°æ®"""
    socketio.emit('market_data', {
        'symbol': symbol,
        'price': data['price'],
        'volume': data['volume'],
        'timestamp': data['timestamp']
    }, room=f'market_{symbol}')

def push_order_update(user_id, order):
    """æ¨é€è®¢å•æ›´æ–°"""
    socketio.emit('order_update', {
        'order_id': order['id'],
        'status': order['status'],
        'filled_qty': order['filled_qty']
    }, room=f'user_{user_id}')
```

## ğŸ“Š æ•°æ®åº“å¼€å‘

### æ•°æ®åº“è®¾è®¡

#### 1. è¡¨ç»“æ„è®¾è®¡
```sql
-- è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯è¡¨
CREATE TABLE stocks (
    symbol VARCHAR(20) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    market VARCHAR(10) NOT NULL,
    industry VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- æ—¥çº¿æ•°æ®è¡¨
CREATE TABLE daily_data (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    symbol VARCHAR(20) NOT NULL,
    trade_date DATE NOT NULL,
    open DECIMAL(10,2) NOT NULL,
    high DECIMAL(10,2) NOT NULL,
    low DECIMAL(10,2) NOT NULL,
    close DECIMAL(10,2) NOT NULL,
    volume BIGINT NOT NULL,
    amount DECIMAL(15,2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_symbol_date (symbol, trade_date),
    INDEX idx_symbol (symbol),
    INDEX idx_date (trade_date)
);

-- ç­–ç•¥é…ç½®è¡¨
CREATE TABLE strategies (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    class_name VARCHAR(100) NOT NULL,
    params JSON NOT NULL,
    status ENUM('active', 'inactive', 'error') DEFAULT 'inactive',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 2. æ•°æ®è®¿é—®å±‚
```python
# data/models.py
from sqlalchemy import create_engine, Column, String, Integer, DateTime, JSON
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker

Base = declarative_base()

class Stock(Base):
    __tablename__ = 'stocks'
    
    symbol = Column(String(20), primary_key=True)
    name = Column(String(100), nullable=False)
    market = Column(String(10), nullable=False)
    industry = Column(String(50))
    created_at = Column(DateTime)
    updated_at = Column(DateTime)

class DailyData(Base):
    __tablename__ = 'daily_data'
    
    id = Column(Integer, primary_key=True)
    symbol = Column(String(20), nullable=False)
    trade_date = Column(DateTime, nullable=False)
    # ... å…¶ä»–å­—æ®µ

# data/database.py
class DatabaseManager:
    def __init__(self, database_url):
        self.engine = create_engine(database_url)
        self.Session = sessionmaker(bind=self.engine)
        
    def get_session(self):
        return self.Session()
        
    def get_stock_data(self, symbol, start_date, end_date):
        with self.get_session() as session:
            query = session.query(DailyData).filter(
                DailyData.symbol == symbol,
                DailyData.trade_date >= start_date,
                DailyData.trade_date <= end_date
            ).order_by(DailyData.trade_date)
            return query.all()
```

### æ•°æ®åº“è¿ç§»

#### 1. Alembicé…ç½®
```python
# migrations/alembic.ini
[alembic]
script_location = migrations
sqlalchemy.url = mysql://user:pass@localhost/dbname

# migrations/env.py
from alembic import context
from sqlalchemy import engine_from_config
from data.models import Base

target_metadata = Base.metadata

def run_migrations_online():
    connectable = engine_from_config(
        context.config.get_section(context.config.config_ini_section),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection, target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()
```

#### 2. è¿ç§»æ“ä½œ
```bash
# ç”Ÿæˆè¿ç§»æ–‡ä»¶
alembic revision --autogenerate -m "Add strategy table"

# æ‰§è¡Œè¿ç§»
alembic upgrade head

# å›æ»šè¿ç§»
alembic downgrade -1

# æŸ¥çœ‹è¿ç§»å†å²
alembic history
```

## ğŸ”Œ ç­–ç•¥å¼€å‘æ¡†æ¶

### ç­–ç•¥åŸºç±»æ‰©å±•

#### 1. é«˜çº§ç­–ç•¥åŸºç±»
```python
# strategies/advanced_strategy.py
from abc import ABC, abstractmethod
import pandas as pd
from typing import Dict, Any, Optional

class AdvancedStrategy(ABC):
    """é«˜çº§ç­–ç•¥åŸºç±»"""
    
    def __init__(self, name: str, params: Dict[str, Any]):
        self.name = name
        self.params = params
        self.positions: Dict[str, int] = {}
        self.indicators: Dict[str, pd.Series] = {}
        self.context = {}
        
    @abstractmethod
    def initialize(self, context):
        """ç­–ç•¥åˆå§‹åŒ–"""
        pass
        
    @abstractmethod
    def before_trading_start(self, context, data):
        """ç›˜å‰å¤„ç†"""
        pass
        
    @abstractmethod
    def handle_data(self, context, data):
        """æ•°æ®å¤„ç†"""
        pass
        
    @abstractmethod
    def after_trading_end(self, context, data):
        """ç›˜åå¤„ç†"""
        pass
        
    def calculate_indicators(self, data: pd.DataFrame) -> Dict[str, pd.Series]:
        """è®¡ç®—æŠ€æœ¯æŒ‡æ ‡"""
        indicators = {}
        
        # RSI
        if 'rsi_period' in self.params:
            indicators['rsi'] = self._calculate_rsi(data['close'], self.params['rsi_period'])
            
        # MACD
        if 'macd_fast' in self.params:
            indicators['macd'] = self._calculate_macd(
                data['close'], 
                self.params['macd_fast'], 
                self.params['macd_slow'], 
                self.params['macd_signal']
            )
            
        return indicators
        
    def _calculate_rsi(self, prices: pd.Series, period: int) -> pd.Series:
        """è®¡ç®—RSIæŒ‡æ ‡"""
        delta = prices.diff()
        gain = (delta.where(delta > 0, 0)).rolling(window=period).mean()
        loss = (-delta.where(delta < 0, 0)).rolling(window=period).mean()
        rs = gain / loss
        return 100 - (100 / (1 + rs))
        
    def _calculate_macd(self, prices: pd.Series, fast: int, slow: int, signal: int):
        """è®¡ç®—MACDæŒ‡æ ‡"""
        ema_fast = prices.ewm(span=fast).mean()
        ema_slow = prices.ewm(span=slow).mean()
        macd_line = ema_fast - ema_slow
        signal_line = macd_line.ewm(span=signal).mean()
        histogram = macd_line - signal_line
        
        return {
            'macd': macd_line,
            'signal': signal_line,
            'histogram': histogram
        }
```

#### 2. å…·ä½“ç­–ç•¥å®ç°
```python
# strategies/momentum_strategy.py
from .advanced_strategy import AdvancedStrategy

class MomentumStrategy(AdvancedStrategy):
    """åŠ¨é‡ç­–ç•¥"""
    
    def initialize(self, context):
        """åˆå§‹åŒ–ç­–ç•¥"""
        self.lookback_period = self.params.get('lookback_period', 20)
        self.momentum_threshold = self.params.get('momentum_threshold', 0.05)
        self.position_size = self.params.get('position_size', 0.1)
        
    def before_trading_start(self, context, data):
        """ç›˜å‰å¤„ç†"""
        # æ›´æ–°è‚¡ç¥¨æ± 
        self.update_universe(context, data)
        
    def handle_data(self, context, data):
        """å¤„ç†æ•°æ®"""
        for symbol in context.universe:
            current_price = data.current(symbol, 'close')
            historical_data = data.history(symbol, 'close', self.lookback_period)
            
            # è®¡ç®—åŠ¨é‡æŒ‡æ ‡
            momentum = (current_price - historical_data.iloc[0]) / historical_data.iloc[0]
            
            # ç”Ÿæˆäº¤æ˜“ä¿¡å·
            if momentum > self.momentum_threshold:
                self.buy_signal(context, symbol, current_price)
            elif momentum < -self.momentum_threshold:
                self.sell_signal(context, symbol, current_price)
                
    def after_trading_end(self, context, data):
        """ç›˜åå¤„ç†"""
        # æ›´æ–°æŒä»“è®°å½•
        self.update_positions(context)
        
    def buy_signal(self, context, symbol, price):
        """ä¹°å…¥ä¿¡å·"""
        if symbol not in self.positions or self.positions[symbol] == 0:
            target_value = context.portfolio.total_value * self.position_size
            quantity = int(target_value / price)
            
            if quantity > 0:
                context.order_target_percent(symbol, self.position_size)
                self.positions[symbol] = quantity
                
    def sell_signal(self, context, symbol, price):
        """å–å‡ºä¿¡å·"""
        if symbol in self.positions and self.positions[symbol] > 0:
            context.order_target_percent(symbol, 0)
            self.positions[symbol] = 0
```

### ç­–ç•¥æ³¨å†Œå’Œç®¡ç†

#### 1. ç­–ç•¥æ³¨å†Œæœºåˆ¶
```python
# strategies/registry.py
from typing import Dict, Type
from .base_strategy import BaseStrategy

class StrategyRegistry:
    """ç­–ç•¥æ³¨å†Œè¡¨"""
    
    _strategies: Dict[str, Type[BaseStrategy]] = {}
    
    @classmethod
    def register(cls, name: str):
        """ç­–ç•¥æ³¨å†Œè£…é¥°å™¨"""
        def decorator(strategy_class):
            cls._strategies[name] = strategy_class
            return strategy_class
        return decorator
        
    @classmethod
    def get_strategy(cls, name: str) -> Type[BaseStrategy]:
        """è·å–ç­–ç•¥ç±»"""
        if name not in cls._strategies:
            raise ValueError(f"Strategy '{name}' not found")
        return cls._strategies[name]
        
    @classmethod
    def list_strategies(cls) -> Dict[str, Type[BaseStrategy]]:
        """åˆ—å‡ºæ‰€æœ‰ç­–ç•¥"""
        return cls._strategies.copy()

# ä½¿ç”¨ç¤ºä¾‹
@StrategyRegistry.register('momentum')
class MomentumStrategy(AdvancedStrategy):
    pass

@StrategyRegistry.register('mean_reversion')
class MeanReversionStrategy(AdvancedStrategy):
    pass
```

#### 2. ç­–ç•¥é…ç½®ç®¡ç†
```python
# strategies/config_manager.py
import json
from typing import Dict, Any

class StrategyConfigManager:
    """ç­–ç•¥é…ç½®ç®¡ç†å™¨"""
    
    def __init__(self, config_file: str):
        self.config_file = config_file
        self.configs = self._load_configs()
        
    def _load_configs(self) -> Dict[str, Any]:
        """åŠ è½½é…ç½®æ–‡ä»¶"""
        try:
            with open(self.config_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        except FileNotFoundError:
            return {}
            
    def save_configs(self):
        """ä¿å­˜é…ç½®æ–‡ä»¶"""
        with open(self.config_file, 'w', encoding='utf-8') as f:
            json.dump(self.configs, f, indent=2, ensure_ascii=False)
            
    def get_strategy_config(self, strategy_name: str) -> Dict[str, Any]:
        """è·å–ç­–ç•¥é…ç½®"""
        return self.configs.get(strategy_name, {})
        
    def set_strategy_config(self, strategy_name: str, config: Dict[str, Any]):
        """è®¾ç½®ç­–ç•¥é…ç½®"""
        self.configs[strategy_name] = config
        self.save_configs()
        
    def validate_config(self, strategy_name: str, config: Dict[str, Any]) -> bool:
        """éªŒè¯ç­–ç•¥é…ç½®"""
        # è·å–ç­–ç•¥ç±»
        strategy_class = StrategyRegistry.get_strategy(strategy_name)
        
        # æ£€æŸ¥å¿…éœ€å‚æ•°
        required_params = getattr(strategy_class, 'REQUIRED_PARAMS', [])
        for param in required_params:
            if param not in config:
                raise ValueError(f"Missing required parameter: {param}")
                
        return True
```

## ğŸ” è°ƒè¯•æŠ€å·§

### æ—¥å¿—ç³»ç»Ÿ

#### 1. æ—¥å¿—é…ç½®
```python
# utils/logger.py
import logging
import logging.handlers
import os

def setup_logger(name: str, log_file: str, level=logging.INFO):
    """è®¾ç½®æ—¥å¿—å™¨"""
    
    # åˆ›å»ºæ—¥å¿—ç›®å½•
    os.makedirs(os.path.dirname(log_file), exist_ok=True)
    
    # åˆ›å»ºæ—¥å¿—å™¨
    logger = logging.getLogger(name)
    logger.setLevel(level)
    
    # åˆ›å»ºæ ¼å¼å™¨
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    
    # æ–‡ä»¶å¤„ç†å™¨ï¼ˆè½®è½¬ï¼‰
    file_handler = logging.handlers.RotatingFileHandler(
        log_file, maxBytes=10*1024*1024, backupCount=5
    )
    file_handler.setFormatter(formatter)
    logger.addHandler(file_handler)
    
    # æ§åˆ¶å°å¤„ç†å™¨
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)
    logger.addHandler(console_handler)
    
    return logger

# ä½¿ç”¨ç¤ºä¾‹
logger = setup_logger('strategy', 'logs/strategy.log')
logger.info('ç­–ç•¥å¼€å§‹æ‰§è¡Œ')
```

#### 2. ç­–ç•¥æ—¥å¿—
```python
# strategies/base_strategy.py
import logging

class BaseStrategy:
    def __init__(self, name):
        self.name = name
        self.logger = logging.getLogger(f'strategy.{name}')
        
    def handle_data(self, context, data):
        self.logger.debug(f'å¤„ç†æ•°æ®: {data.current_dt}')
        
        # ç­–ç•¥é€»è¾‘
        signals = self.generate_signals(context, data)
        self.logger.info(f'ç”Ÿæˆä¿¡å·: {signals}')
        
        for signal in signals:
            if signal['action'] == 'buy':
                self.logger.info(f'ä¹°å…¥ä¿¡å·: {signal["symbol"]} ä»·æ ¼: {signal["price"]}')
            elif signal['action'] == 'sell':
                self.logger.warning(f'å–å‡ºä¿¡å·: {signal["symbol"]} ä»·æ ¼: {signal["price"]}')
```

### æ€§èƒ½åˆ†æ

#### 1. æ€§èƒ½ç›‘æ§è£…é¥°å™¨
```python
# utils/performance.py
import time
import functools
from typing import Callable

def timing(func: Callable) -> Callable:
    """è®¡æ—¶è£…é¥°å™¨"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        
        logger = logging.getLogger(func.__module__)
        logger.debug(f'{func.__name__} æ‰§è¡Œæ—¶é—´: {end_time - start_time:.4f}ç§’')
        
        return result
    return wrapper

def memory_usage(func: Callable) -> Callable:
    """å†…å­˜ä½¿ç”¨ç›‘æ§è£…é¥°å™¨"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        import psutil
        process = psutil.Process()
        
        mem_before = process.memory_info().rss / 1024 / 1024  # MB
        result = func(*args, **kwargs)
        mem_after = process.memory_info().rss / 1024 / 1024  # MB
        
        logger = logging.getLogger(func.__module__)
        logger.debug(f'{func.__name__} å†…å­˜ä½¿ç”¨: {mem_after - mem_before:.2f}MB')
        
        return result
    return wrapper

# ä½¿ç”¨ç¤ºä¾‹
@timing
@memory_usage
def calculate_indicators(data):
    # è®¡ç®—æŒ‡æ ‡
    pass
```

#### 2. æ€§èƒ½åˆ†æå·¥å…·
```python
# utils/profiler.py
import cProfile
import pstats
import io

class PerformanceProfiler:
    """æ€§èƒ½åˆ†æå™¨"""
    
    def __init__(self):
        self.profiler = cProfile.Profile()
        
    def start(self):
        """å¼€å§‹æ€§èƒ½åˆ†æ"""
        self.profiler.enable()
        
    def stop(self):
        """åœæ­¢æ€§èƒ½åˆ†æ"""
        self.profiler.disable()
        
    def get_stats(self, sort_by='cumulative', lines=20):
        """è·å–æ€§èƒ½ç»Ÿè®¡"""
        s = io.StringIO()
        ps = pstats.Stats(self.profiler, stream=s)
        ps.sort_stats(sort_by)
        ps.print_stats(lines)
        return s.getvalue()
        
    def save_stats(self, filename):
        """ä¿å­˜æ€§èƒ½ç»Ÿè®¡åˆ°æ–‡ä»¶"""
        self.profiler.dump_stats(filename)

# ä½¿ç”¨ç¤ºä¾‹
profiler = PerformanceProfiler()
profiler.start()

# æ‰§è¡Œéœ€è¦åˆ†æçš„ä»£ç 
backtest_engine.run()

profiler.stop()
print(profiler.get_stats())
```

## ğŸ“¦ æ‰“åŒ…å‘å¸ƒ

### æ„å»ºé…ç½®

#### 1. setup.py
```python
from setuptools import setup, find_packages

with open("README.md", "r", encoding="utf-8") as fh:
    long_description = fh.read()

with open("requirements.txt", "r", encoding="utf-8") as fh:
    requirements = fh.read().splitlines()

setup(
    name="lianghua-trading",
    version="1.0.0",
    author="LiangHua Team",
    author_email="contact@lianghua.com",
    description="é‡åŒ–äº¤æ˜“ç³»ç»Ÿ",
    long_description=long_description,
    long_description_content_type="text/markdown",
    url="https://github.com/your-repo/lianghua_vn",
    packages=find_packages(),
    classifiers=[
        "Development Status :: 4 - Beta",
        "Intended Audience :: Financial and Insurance Industry",
        "License :: OSI Approved :: MIT License",
        "Operating System :: OS Independent",
        "Programming Language :: Python :: 3",
        "Programming Language :: Python :: 3.8",
        "Programming Language :: Python :: 3.9",
        "Programming Language :: Python :: 3.10",
    ],
    python_requires=">=3.8",
    install_requires=requirements,
    extras_require={
        "dev": [
            "pytest>=6.0",
            "black>=21.0",
            "flake8>=3.8",
            "mypy>=0.910",
        ],
    },
    entry_points={
        "console_scripts": [
            "lianghua-monitor=monitor.web_app:main",
            "lianghua-backtest=backtest.cli:main",
        ],
    },
    include_package_data=True,
    package_data={
        "monitor": ["static/*", "templates/*"],
    },
)
```

#### 2. æ„å»ºè„šæœ¬
```bash
#!/bin/bash
# scripts/build.sh

set -e

echo "å¼€å§‹æ„å»ºé¡¹ç›®..."

# æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶
rm -rf build/ dist/ *.egg-info/

# æ›´æ–°ç‰ˆæœ¬å·
python scripts/update_version.py

# è¿è¡Œæµ‹è¯•
pytest

# ä»£ç æ£€æŸ¥
flake8 src/
black --check src/
mypy src/

# æ„å»ºåŒ…
python setup.py sdist bdist_wheel

# æ£€æŸ¥åŒ…
twine check dist/*

echo "æ„å»ºå®Œæˆï¼"
```

### Dockeré•œåƒ

#### 1. å¤šé˜¶æ®µæ„å»º
```dockerfile
# Dockerfile.prod
# ç¬¬ä¸€é˜¶æ®µï¼šæ„å»ºé˜¶æ®µ
FROM python:3.9-slim as builder

WORKDIR /app

# å®‰è£…æ„å»ºä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .
RUN pip install --user --no-cache-dir -r requirements.txt

# ç¬¬äºŒé˜¶æ®µï¼šè¿è¡Œé˜¶æ®µ
FROM python:3.9-slim

WORKDIR /app

# åˆ›å»ºérootç”¨æˆ·
RUN useradd --create-home --shell /bin/bash lianghua

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶åŒ…
COPY --from=builder /root/.local /home/lianghua/.local

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .
RUN chown -R lianghua:lianghua /app

# åˆ‡æ¢ç”¨æˆ·
USER lianghua

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV PATH=/home/lianghua/.local/bin:$PATH
ENV PYTHONPATH=/app

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:5000/health || exit 1

# æš´éœ²ç«¯å£
EXPOSE 5000

# å¯åŠ¨å‘½ä»¤
CMD ["python", "run_monitor.py", "--host", "0.0.0.0"]
```

#### 2. é•œåƒæ„å»ºè„šæœ¬
```bash
#!/bin/bash
# scripts/build_docker.sh

set -e

# è·å–ç‰ˆæœ¬å·
VERSION=$(cat VERSION)
IMAGE_NAME="lianghua/trading-system"

echo "æ„å»ºDockeré•œåƒ: ${IMAGE_NAME}:${VERSION}"

# æ„å»ºé•œåƒ
docker build -f Dockerfile.prod -t ${IMAGE_NAME}:${VERSION} .
docker tag ${IMAGE_NAME}:${VERSION} ${IMAGE_NAME}:latest

# æ¨é€é•œåƒï¼ˆå¯é€‰ï¼‰
if [ "$1" = "--push" ]; then
    echo "æ¨é€é•œåƒåˆ°ä»“åº“..."
    docker push ${IMAGE_NAME}:${VERSION}
    docker push ${IMAGE_NAME}:latest
fi

echo "Dockeré•œåƒæ„å»ºå®Œæˆï¼"
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´8æœˆ18æ—¥  
**ç»´æŠ¤å›¢é˜Ÿ**: å¼€å‘å›¢é˜Ÿ