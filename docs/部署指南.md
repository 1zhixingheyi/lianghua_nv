# é‡åŒ–äº¤æ˜“ç³»ç»Ÿéƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†é‡åŒ–äº¤æ˜“ç³»ç»Ÿåœ¨ä¸åŒç¯å¢ƒä¸‹çš„éƒ¨ç½²æ–¹æ³•ï¼ŒåŒ…æ‹¬å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å®Œæ•´éƒ¨ç½²æµç¨‹ã€‚

## ğŸ¯ éƒ¨ç½²ç¯å¢ƒ

### æ”¯æŒçš„éƒ¨ç½²æ–¹å¼

1. **æœ¬åœ°å¼€å‘éƒ¨ç½²** - é€‚ç”¨äºå¼€å‘è°ƒè¯•
2. **Dockerå®¹å™¨éƒ¨ç½²** - é€‚ç”¨äºæµ‹è¯•å’Œç”Ÿäº§
3. **äº‘æœåŠ¡å™¨éƒ¨ç½²** - é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ
4. **é›†ç¾¤éƒ¨ç½²** - é€‚ç”¨äºé«˜å¯ç”¨ç”Ÿäº§ç¯å¢ƒ

### ç³»ç»Ÿè¦æ±‚

#### æœ€ä½é…ç½®
- **CPU**: 2æ ¸å¿ƒ
- **å†…å­˜**: 4GB
- **å­˜å‚¨**: 20GBå¯ç”¨ç©ºé—´
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 18.04+, CentOS 7+, Windows 10+

#### æ¨èé…ç½®
- **CPU**: 4æ ¸å¿ƒ
- **å†…å­˜**: 8GB
- **å­˜å‚¨**: 100GB SSD
- **ç½‘ç»œ**: 100Mbpså¸¦å®½

#### ç”Ÿäº§ç¯å¢ƒé…ç½®
- **CPU**: 8æ ¸å¿ƒ
- **å†…å­˜**: 16GB
- **å­˜å‚¨**: 500GB SSD
- **ç½‘ç»œ**: 1Gbpså¸¦å®½

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### 1. ç³»ç»Ÿç¯å¢ƒé…ç½®

#### Ubuntu/Debianç³»ç»Ÿ
```bash
# æ›´æ–°ç³»ç»ŸåŒ…
sudo apt update && sudo apt upgrade -y

# å®‰è£…å¿…è¦å·¥å…·
sudo apt install -y git curl wget vim htop

# å®‰è£…Python 3.8+
sudo apt install -y python3.8 python3.8-pip python3.8-venv

# å®‰è£…æ•°æ®åº“
sudo apt install -y mysql-server redis-server

# å¯åŠ¨æœåŠ¡
sudo systemctl start mysql redis-server
sudo systemctl enable mysql redis-server
```

#### CentOS/RHELç³»ç»Ÿ
```bash
# æ›´æ–°ç³»ç»ŸåŒ…
sudo yum update -y

# å®‰è£…å¿…è¦å·¥å…·
sudo yum install -y git curl wget vim htop

# å®‰è£…Python 3.8+
sudo yum install -y python38 python38-pip

# å®‰è£…æ•°æ®åº“
sudo yum install -y mysql-server redis

# å¯åŠ¨æœåŠ¡
sudo systemctl start mysqld redis
sudo systemctl enable mysqld redis
```

#### Windowsç³»ç»Ÿ
1. å®‰è£…Python 3.8+ (https://python.org)
2. å®‰è£…Git (https://git-scm.com)
3. å®‰è£…MySQL (https://mysql.com)
4. å®‰è£…Redis (https://redis.io)

### 2. æ•°æ®åº“é…ç½®

#### MySQLé…ç½®
```bash
# å®‰å…¨åˆå§‹åŒ–
sudo mysql_secure_installation

# åˆ›å»ºæ•°æ®åº“
mysql -u root -p
```

```sql
CREATE DATABASE lianghua_trading CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'lianghua'@'localhost' IDENTIFIED BY 'strong_password';
GRANT ALL PRIVILEGES ON lianghua_trading.* TO 'lianghua'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

#### Redisé…ç½®
```bash
# ç¼–è¾‘Redisé…ç½®
sudo vim /etc/redis/redis.conf

# ä¿®æ”¹ä»¥ä¸‹é…ç½®
bind 127.0.0.1
port 6379
requirepass your_redis_password
maxmemory 1gb
maxmemory-policy allkeys-lru

# é‡å¯Redis
sudo systemctl restart redis
```

## ğŸš€ æœ¬åœ°å¼€å‘éƒ¨ç½²

### 1. è·å–æºç 

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-repo/lianghua_vn.git
cd lianghua_vn

# åˆ‡æ¢åˆ°æŒ‡å®šç‰ˆæœ¬(å¯é€‰)
git checkout v1.0.0
```

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
# åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate     # Windows
```

### 3. å®‰è£…ä¾èµ–

```bash
# å‡çº§pip
pip install --upgrade pip

# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt

# å®‰è£…å¼€å‘ä¾èµ–(å¯é€‰)
pip install -r requirements-dev.txt
```

### 4. ç¯å¢ƒå˜é‡é…ç½®

ç³»ç»Ÿé‡‡ç”¨ä¼ä¸šçº§å››å±‚å­˜å‚¨æ¶æ„ï¼Œéœ€è¦é…ç½®å®Œæ•´çš„ç¯å¢ƒå˜é‡ï¼š

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
vim .env
```

```bash
# .envæ–‡ä»¶å†…å®¹ - å››å±‚å­˜å‚¨æ¶æ„é…ç½®

# MySQLé…ç½® (ç»“æ„åŒ–æ•°æ®å±‚)
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=lianghua
MYSQL_PASSWORD=strong_password_here
MYSQL_DATABASE=lianghua_trading

# ClickHouseé…ç½® (åˆ†æå±‚)
CLICKHOUSE_HOST=localhost
CLICKHOUSE_PORT=9000
CLICKHOUSE_USER=default
CLICKHOUSE_PASSWORD=clickhouse_password
CLICKHOUSE_DATABASE=lianghua_analytics

# Redisé…ç½® (ç¼“å­˜å±‚)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=redis_password_here
REDIS_DB=0

# MinIOé…ç½® (å¯¹è±¡å­˜å‚¨å±‚)
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minio_access_key
MINIO_SECRET_KEY=minio_secret_key
MINIO_SECURE=false

# APIé…ç½®
TUSHARE_TOKEN=your_tushare_token

# ç³»ç»Ÿé…ç½®
ENVIRONMENT=production
DEBUG_MODE=false
SECRET_KEY=your_secret_key_here
JWT_SECRET_KEY=your_jwt_secret_key

# QMTé…ç½®
QMT_PATH=/path/to/qmt

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=logs/app.log
```

### 5. é…ç½®éªŒè¯

```bash
# éªŒè¯é…ç½®å®Œæ•´æ€§
python -c "
from config import config_manager
is_valid, errors = config_manager.validate()
if is_valid:
    print('âœ… é…ç½®éªŒè¯é€šè¿‡')
else:
    print('âŒ é…ç½®éªŒè¯å¤±è´¥:')
    for error in errors:
        print(f'  - {error}')
"

# æµ‹è¯•å››å±‚å­˜å‚¨è¿æ¥
python -c "
from config import get_mysql_config, get_redis_config
print('MySQLé…ç½®:', get_mysql_config()['database']['host'])
print('Redisé…ç½®:', get_redis_config()['connection']['host'])
"
```

### 5. æ•°æ®åº“åˆå§‹åŒ–

```bash
# åˆ›å»ºæ•°æ®åº“è¡¨
python -c "
from data.database import init_database
init_database()
print('æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ')
"

# å¯¼å…¥åˆå§‹æ•°æ®(å¯é€‰)
python scripts/import_initial_data.py
```

### 6. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨WebæœåŠ¡
python run_monitor.py

# æˆ–è€…ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨
python run_monitor.py --debug

# æŒ‡å®šç«¯å£å¯åŠ¨
python run_monitor.py --port 8080
```

### 7. éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:5000/health

# è¿è¡Œç³»ç»Ÿæµ‹è¯•
python run_tests.py

# æ£€æŸ¥APIæ¥å£
curl http://localhost:5000/api/dashboard/summary
```

## ğŸ³ Dockerå®¹å™¨éƒ¨ç½²

### 1. Dockerç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£…Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# å¯åŠ¨DockeræœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker
```

### 2. åˆ›å»ºDockerfile

```dockerfile
# Dockerfile
FROM python:3.8-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£…Pythonä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# åˆ›å»ºæ—¥å¿—ç›®å½•
RUN mkdir -p logs

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV PYTHONPATH=/app
ENV FLASK_APP=monitor.web_app:app

# æš´éœ²ç«¯å£
EXPOSE 5000

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:5000/health || exit 1

# å¯åŠ¨å‘½ä»¤
CMD ["python", "run_monitor.py", "--host", "0.0.0.0"]
```

### 3. åˆ›å»ºDocker Composeé…ç½®

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "5000:5000"
    environment:
      # å››å±‚å­˜å‚¨æ¶æ„é…ç½®
      - MYSQL_HOST=mysql
      - MYSQL_PORT=3306
      - MYSQL_USER=lianghua
      - MYSQL_PASSWORD=password
      - MYSQL_DATABASE=lianghua_trading
      
      - CLICKHOUSE_HOST=clickhouse
      - CLICKHOUSE_PORT=9000
      - CLICKHOUSE_DATABASE=lianghua_analytics
      
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - REDIS_PASSWORD=password
      
      - MINIO_ENDPOINT=minio:9000
      - MINIO_ACCESS_KEY=minioadmin
      - MINIO_SECRET_KEY=minioadmin
      
      # ç³»ç»Ÿé…ç½®
      - ENVIRONMENT=production
      - SECRET_KEY=your_secret_key_here
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./config:/app/config
    depends_on:
      - mysql
      - clickhouse
      - redis
      - minio
    restart: unless-stopped

  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=root_password
      - MYSQL_DATABASE=lianghua_trading
      - MYSQL_USER=lianghua
      - MYSQL_PASSWORD=password
    volumes:
      - mysql_data:/var/lib/mysql
      - ./sql/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    command: redis-server --requirepass password
    volumes:
      - redis_data:/data
    ports:
      - "6379:6379"
    restart: unless-stopped

  clickhouse:
    image: clickhouse/clickhouse-server:latest
    environment:
      - CLICKHOUSE_DB=lianghua_analytics
      - CLICKHOUSE_USER=default
      - CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT=1
    volumes:
      - clickhouse_data:/var/lib/clickhouse
    ports:
      - "9000:9000"
      - "8123:8123"
    restart: unless-stopped

  minio:
    image: minio/minio:latest
    environment:
      - MINIO_ACCESS_KEY=minioadmin
      - MINIO_SECRET_KEY=minioadmin
    volumes:
      - minio_data:/data
    ports:
      - "9000:9000"
      - "9001:9001"
    command: server /data --console-address ":9001"
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
    depends_on:
      - app
    restart: unless-stopped

volumes:
  mysql_data:
  clickhouse_data:
  redis_data:
  minio_data:
```

### 4. åˆ›å»ºNginxé…ç½®

```nginx
# nginx/nginx.conf
events {
    worker_connections 1024;
}

http {
    upstream app {
        server app:5000;
    }

    server {
        listen 80;
        server_name localhost;

        location / {
            proxy_pass http://app;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /ws {
            proxy_pass http://app;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
        }
    }
}
```

### 5. å®¹å™¨éƒ¨ç½²

```bash
# æ„å»ºå’Œå¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f app

# åœæ­¢æœåŠ¡
docker-compose down

# é‡æ–°æ„å»º
docker-compose up -d --build
```

## â˜ï¸ äº‘æœåŠ¡å™¨éƒ¨ç½²

### 1. äº‘æœåŠ¡å™¨é€‰æ‹©

#### é˜¿é‡Œäº‘ECS
```bash
# è´­ä¹°ECSå®ä¾‹
# è§„æ ¼ï¼šecs.c6.xlarge (4æ ¸8GB)
# ç³»ç»Ÿï¼šUbuntu 20.04 LTS
# å­˜å‚¨ï¼š100GB ESSDäº‘ç›˜
# ç½‘ç»œï¼šä¸“æœ‰ç½‘ç»œVPC
```

#### è…¾è®¯äº‘CVM
```bash
# è´­ä¹°CVMå®ä¾‹
# è§„æ ¼ï¼šS5.LARGE8 (4æ ¸8GB)
# ç³»ç»Ÿï¼šUbuntu Server 20.04 LTS
# å­˜å‚¨ï¼š100GBé«˜æ€§èƒ½äº‘ç¡¬ç›˜
# ç½‘ç»œï¼šç§æœ‰ç½‘ç»œVPC
```

#### AWS EC2
```bash
# å¯åŠ¨EC2å®ä¾‹
# å®ä¾‹ç±»å‹ï¼št3.large (2æ ¸8GB)
# AMIï¼šUbuntu Server 20.04 LTS
# å­˜å‚¨ï¼š100GB gp3
# ç½‘ç»œï¼šVPC
```

### 2. æœåŠ¡å™¨åˆå§‹é…ç½®

```bash
# è¿æ¥åˆ°æœåŠ¡å™¨
ssh -i your-key.pem ubuntu@server-ip

# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# åˆ›å»ºåº”ç”¨ç”¨æˆ·
sudo useradd -m -s /bin/bash lianghua
sudo usermod -aG sudo lianghua

# é…ç½®SSHå¯†é’¥
sudo mkdir -p /home/lianghua/.ssh
sudo cp ~/.ssh/authorized_keys /home/lianghua/.ssh/
sudo chown -R lianghua:lianghua /home/lianghua/.ssh
sudo chmod 700 /home/lianghua/.ssh
sudo chmod 600 /home/lianghua/.ssh/authorized_keys
```

### 3. å®‰å…¨é…ç½®

```bash
# é…ç½®é˜²ç«å¢™
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 5000  # å¼€å‘ç¯å¢ƒ

# é…ç½®fail2ban
sudo apt install -y fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

# ç¦ç”¨rootç™»å½•
sudo vim /etc/ssh/sshd_config
# è®¾ç½®: PermitRootLogin no
sudo systemctl restart sshd
```

### 4. éƒ¨ç½²åº”ç”¨

```bash
# åˆ‡æ¢åˆ°åº”ç”¨ç”¨æˆ·
su - lianghua

# å…‹éš†ä»£ç 
git clone https://github.com/your-repo/lianghua_vn.git
cd lianghua_vn

# ä½¿ç”¨Dockeréƒ¨ç½²
docker-compose up -d

# æˆ–ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼éƒ¨ç½²
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### 5. åŸŸåå’ŒSSLé…ç½®

```bash
# å®‰è£…Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 2 * * * certbot renew --quiet
```

## ğŸ—ï¸ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. é«˜å¯ç”¨æ¶æ„

```yaml
# docker-compose.prod.yml
version: '3.8'

services:
  app1:
    build: .
    environment:
      - DATABASE_URL=mysql://lianghua:password@mysql-master:3306/lianghua_trading
      - REDIS_URL=redis://:password@redis-master:6379/0
    restart: always

  app2:
    build: .
    environment:
      - DATABASE_URL=mysql://lianghua:password@mysql-master:3306/lianghua_trading
      - REDIS_URL=redis://:password@redis-master:6379/0
    restart: always

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/prod.conf:/etc/nginx/nginx.conf
    depends_on:
      - app1
      - app2
    restart: always

  mysql-master:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=strong_password
      - MYSQL_REPLICATION_MODE=master
    volumes:
      - mysql_master_data:/var/lib/mysql
    restart: always

  mysql-slave:
    image: mysql:8.0
    environment:
      - MYSQL_REPLICATION_MODE=slave
      - MYSQL_MASTER_HOST=mysql-master
    volumes:
      - mysql_slave_data:/var/lib/mysql
    restart: always

  redis-master:
    image: redis:7-alpine
    command: redis-server --requirepass strong_password
    volumes:
      - redis_master_data:/data
    restart: always

  redis-slave:
    image: redis:7-alpine
    command: redis-server --slaveof redis-master 6379 --requirepass strong_password
    volumes:
      - redis_slave_data:/data
    restart: always

volumes:
  mysql_master_data:
  mysql_slave_data:
  redis_master_data:
  redis_slave_data:
```

### 2. è´Ÿè½½å‡è¡¡é…ç½®

```nginx
# nginx/prod.conf
upstream app_servers {
    least_conn;
    server app1:5000 weight=1 max_fails=3 fail_timeout=30s;
    server app2:5000 weight=1 max_fails=3 fail_timeout=30s;
}

server {
    listen 80;
    listen 443 ssl http2;
    server_name your-domain.com;

    # SSLé…ç½®
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;

    # å®‰å…¨å¤´
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;

    location / {
        proxy_pass http://app_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # å¥åº·æ£€æŸ¥
        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;
        proxy_next_upstream_timeout 0;
        proxy_next_upstream_tries 3;
    }
}
```

### 3. ç›‘æ§é…ç½®

```yaml
# monitoring/docker-compose.yml
version: '3.8'

services:
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    restart: always

  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin_password
    volumes:
      - grafana_data:/var/lib/grafana
    restart: always

  node-exporter:
    image: prom/node-exporter
    ports:
      - "9100:9100"
    restart: always

volumes:
  prometheus_data:
  grafana_data:
```

### 4. å¤‡ä»½ç­–ç•¥

```bash
#!/bin/bash
# scripts/backup.sh

# æ•°æ®åº“å¤‡ä»½
mysqldump -h mysql-master -u lianghua -p lianghua_trading > backup/db_$(date +%Y%m%d_%H%M%S).sql

# Rediså¤‡ä»½
redis-cli -h redis-master -a password --rdb backup/redis_$(date +%Y%m%d_%H%M%S).rdb

# ä»£ç å¤‡ä»½
tar -czf backup/code_$(date +%Y%m%d_%H%M%S).tar.gz /app

# ä¸Šä¼ åˆ°äº‘å­˜å‚¨
aws s3 cp backup/ s3://your-backup-bucket/ --recursive

# æ¸…ç†æ—§å¤‡ä»½
find backup/ -name "*.sql" -mtime +7 -delete
find backup/ -name "*.rdb" -mtime +7 -delete
find backup/ -name "*.tar.gz" -mtime +7 -delete
```

## ğŸ”§ éƒ¨ç½²è„šæœ¬

### 1. è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# deploy.sh

set -e

# é…ç½®å˜é‡
APP_NAME="lianghua_vn"
DEPLOY_USER="lianghua"
DEPLOY_HOST="your-server.com"
DEPLOY_PATH="/opt/lianghua_vn"
BACKUP_PATH="/opt/backup"

echo "å¼€å§‹éƒ¨ç½² $APP_NAME..."

# å¤‡ä»½å½“å‰ç‰ˆæœ¬
ssh $DEPLOY_USER@$DEPLOY_HOST "
    if [ -d $DEPLOY_PATH ]; then
        sudo cp -r $DEPLOY_PATH $BACKUP_PATH/$(date +%Y%m%d_%H%M%S)
    fi
"

# ä¸Šä¼ æ–°ç‰ˆæœ¬
rsync -avz --exclude='.git' --exclude='venv' --exclude='*.pyc' \
    ./ $DEPLOY_USER@$DEPLOY_HOST:$DEPLOY_PATH/

# éƒ¨ç½²æ–°ç‰ˆæœ¬
ssh $DEPLOY_USER@$DEPLOY_HOST "
    cd $DEPLOY_PATH
    
    # åœæ­¢æœåŠ¡
    docker-compose down
    
    # æ›´æ–°ä¾èµ–
    docker-compose build
    
    # å¯åŠ¨æœåŠ¡
    docker-compose up -d
    
    # å¥åº·æ£€æŸ¥
    sleep 30
    curl -f http://localhost:5000/health || exit 1
"

echo "éƒ¨ç½²å®Œæˆï¼"
```

### 2. æ»šåŠ¨éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# rolling_deploy.sh

# æ»šåŠ¨æ›´æ–°ï¼Œé›¶åœæœºéƒ¨ç½²
for service in app1 app2; do
    echo "æ›´æ–°æœåŠ¡: $service"
    
    # åœæ­¢ä¸€ä¸ªå®ä¾‹
    docker-compose stop $service
    
    # é‡æ–°æ„å»º
    docker-compose build $service
    
    # å¯åŠ¨å®ä¾‹
    docker-compose up -d $service
    
    # å¥åº·æ£€æŸ¥
    sleep 30
    curl -f http://localhost:5000/health || exit 1
    
    echo "æœåŠ¡ $service æ›´æ–°å®Œæˆ"
done
```

## âœ… éƒ¨ç½²éªŒè¯

### 1. åŠŸèƒ½éªŒè¯

```bash
# åŸºæœ¬åŠŸèƒ½æµ‹è¯•
curl -f http://localhost:5000/health
curl -f http://localhost:5000/api/dashboard/summary

# æ•°æ®åº“è¿æ¥æµ‹è¯•
python -c "
from data.database import get_database_manager
db = get_database_manager()
print('æ•°æ®åº“è¿æ¥æˆåŠŸ' if db else 'æ•°æ®åº“è¿æ¥å¤±è´¥')
"

# Redisè¿æ¥æµ‹è¯•
redis-cli ping

# WebSocketæµ‹è¯•
python -c "
import websocket
ws = websocket.create_connection('ws://localhost:5000/ws')
print('WebSocketè¿æ¥æˆåŠŸ')
ws.close()
"
```

### 2. æ€§èƒ½æµ‹è¯•

```bash
# å®‰è£…å‹æµ‹å·¥å…·
sudo apt install -y apache2-utils

# APIå‹æµ‹
ab -n 1000 -c 10 http://localhost:5000/api/dashboard/summary

# å¹¶å‘è¿æ¥æµ‹è¯•
for i in {1..50}; do
    curl http://localhost:5000/health &
done
wait
```

### 3. ç›‘æ§éªŒè¯

```bash
# æ£€æŸ¥ç³»ç»Ÿèµ„æº
htop
iotop
nethogs

# æ£€æŸ¥æ—¥å¿—
tail -f logs/app.log
docker-compose logs -f app

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status nginx
docker-compose ps
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å ç”¨**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :5000
lsof -i :5000

# æ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 <pid>
```

2. **æƒé™é—®é¢˜**
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la
chmod +x run_monitor.py
chown -R lianghua:lianghua /opt/lianghua_vn
```

3. **ä¾èµ–ç¼ºå¤±**
```bash
# é‡æ–°å®‰è£…ä¾èµ–
pip install --upgrade -r requirements.txt

# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version
```

4. **æ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
systemctl status mysql
mysql -u lianghua -p -e "SELECT 1"

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
```

### æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/app.log | grep ERROR

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
journalctl -u lianghua_vn -f

# æŸ¥çœ‹Nginxæ—¥å¿—
tail -f /var/log/nginx/error.log
```

## ğŸ“š æœ€ä½³å®è·µ

### 1. å®‰å…¨æœ€ä½³å®è·µ

- å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œä¾èµ–åŒ…
- ä½¿ç”¨å¼ºå¯†ç å’Œå¯†é’¥è®¤è¯
- é…ç½®é˜²ç«å¢™å’Œå…¥ä¾µæ£€æµ‹
- å®šæœŸå¤‡ä»½æ•°æ®
- ç›‘æ§ç³»ç»Ÿå®‰å…¨æ—¥å¿—

### 2. æ€§èƒ½æœ€ä½³å®è·µ

- ä½¿ç”¨SSDå­˜å‚¨
- é…ç½®æ•°æ®åº“ç´¢å¼•
- å¯ç”¨Redisç¼“å­˜
- ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº
- é…ç½®è´Ÿè½½å‡è¡¡

### 3. è¿ç»´æœ€ä½³å®è·µ

- è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹
- é…ç½®ç›‘æ§å‘Šè­¦
- å»ºç«‹åº”æ€¥å“åº”æµç¨‹
- å®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ
- ç»´æŠ¤è¯¦ç»†çš„æ“ä½œæ–‡æ¡£

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´8æœˆ18æ—¥  
**ç»´æŠ¤å›¢é˜Ÿ**: è¿ç»´å›¢é˜Ÿ